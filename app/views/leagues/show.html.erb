<div class="mb-6">
  <p class="text-sm text-slate-500 mb-1"><%= @league.region %></p>
  <h1 class="text-2xl sm:text-3xl font-bold text-slate-900"><%= @league.name %></h1>
  <p class="text-slate-600 mt-2"><%= number_to_currency(@league.monthly_price_cents / 100.0) %>/month · <%= @league.prize_description %></p>
</div>

<%# Standings card %>
<section class="rounded-2xl bg-white border border-slate-200 shadow-sm overflow-hidden mb-6">
  <h2 class="px-4 sm:px-5 py-3 font-semibold text-slate-900 border-b border-slate-100">Standings</h2>
  <% if @standings.any? %>
    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead>
          <tr class="bg-slate-50 text-slate-500 font-medium">
            <th class="text-left py-3 px-4 w-10">#</th>
            <th class="text-left py-3 px-4">Player</th>
            <th class="text-center py-3 px-2 w-12">W</th>
            <th class="text-center py-3 px-2 w-12">L</th>
            <th class="text-center py-3 px-4 w-14">Played</th>
          </tr>
        </thead>
        <tbody>
          <% @standings.each_with_index do |row, i| %>
            <tr class="border-t border-slate-100 <%= 'bg-green-50/50' if current_user && row[:user].id == current_user.id %>">
              <td class="py-3 px-4 font-medium text-slate-400"><%= i + 1 %></td>
              <td class="py-3 px-4 font-medium text-slate-900"><%= row[:user].name.presence || row[:user].email %><%= " (you)" if current_user && row[:user].id == current_user.id %></td>
              <td class="py-3 px-2 text-center text-green-600 font-semibold"><%= row[:wins] %></td>
              <td class="py-3 px-2 text-center text-slate-600"><%= row[:losses] %></td>
              <td class="py-3 px-4 text-center text-slate-500"><%= row[:games_played] %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <p class="px-4 sm:px-5 py-6 text-slate-500 text-sm">No matches played yet. Standings will appear after results are reported.</p>
  <% end %>
</section>

<%# Join / Leave %>
<% if user_signed_in? %>
  <% if @current_membership %>
    <div class="rounded-2xl bg-green-50 border border-green-200 p-4 mb-6">
      <p class="font-medium text-green-800">You’re in this pool · DUPR <%= @current_membership.dupr_rating %></p>
      <%= button_to "Leave pool", league_membership_path(@league), method: :delete, data: { turbo_confirm: "Leave this pool?" }, class: "mt-3 rounded-xl bg-white border border-red-200 text-red-700 px-4 py-2.5 text-sm font-medium hover:bg-red-50 min-h-[44px]" %>
    </div>
  <% else %>
    <section class="rounded-2xl bg-white border border-slate-200 shadow-sm p-5 sm:p-6 mb-6">
      <h2 class="font-semibold text-slate-900 mb-2">Join this pool</h2>
      <p class="text-sm text-slate-600 mb-4">Your DUPR must be between <%= @league.rating_min %> and <%= @league.rating_max %>.</p>
      <%= form_with model: LeagueMembership.new(league: @league), url: league_membership_path(@league), method: :post, local: true do |f| %>
        <div class="mb-4">
          <%= f.label :dupr_rating, "Your DUPR rating", class: "block text-sm font-medium text-slate-700 mb-1" %>
          <%= f.number_field :dupr_rating, step: 0.1, min: @league.rating_min, max: @league.rating_max, value: @league.rating_min, required: true, class: "w-full rounded-xl border border-slate-300 px-4 py-3 text-base focus:border-green-500 focus:ring-2 focus:ring-green-500/20 min-h-[48px]" %>
        </div>
        <%= f.submit "Join pool", class: "w-full rounded-xl bg-green-500 hover:bg-green-600 text-white font-semibold py-3.5 min-h-[48px] transition-colors" %>
      <% end %>
    </section>
  <% end %>
<% else %>
  <p class="mb-6 text-slate-600"><%= link_to "Sign in", new_user_session_path, class: "text-green-600 font-medium hover:underline" %> to join this pool.</p>
<% end %>

<%# Roster %>
<section class="rounded-2xl bg-white border border-slate-200 shadow-sm overflow-hidden">
  <h2 class="px-4 sm:px-5 py-3 font-semibold text-slate-900 border-b border-slate-100">Roster · <%= @league.league_memberships.count %></h2>
  <% if @league.league_memberships.any? %>
    <ul class="divide-y divide-slate-100">
      <% @league.league_memberships.includes(user: :availabilities).each do |m| %>
        <li class="flex flex-wrap items-center gap-2 sm:gap-3 px-4 sm:px-5 py-4 <%= 'bg-slate-50/50' if current_user && m.user_id == current_user.id %>">
          <div class="min-w-0 flex-1">
            <span class="font-semibold text-slate-900"><%= m.user.name.presence || m.user.email %></span>
            <%= " (you)" if current_user && m.user_id == current_user.id %>
            <div class="flex flex-wrap items-center gap-x-2 gap-y-0.5 text-sm text-slate-500 mt-0.5">
              <span>DUPR <%= m.dupr_rating %></span>
              <span>·</span>
              <span><%= m.user.zone.presence || "—" %></span>
              <%= tag.span("· Can host", class: "text-green-600") if m.user.can_host? %>
              <% if m.user.availabilities.any? %>
                <span class="block sm:inline">· <%= m.user.availabilities.map { |a| "#{a.day_of_week[0..2]} #{a.start_time&.strftime('%l:%M')}" }.join(", ") %></span>
              <% else %>
                <span class="text-slate-400">· No availability</span>
              <% end %>
            </div>
          </div>
          <% if current_user && @current_membership && m.user_id != current_user.id %>
            <%= form_with url: league_matches_path(@league), method: :post, local: true, class: "shrink-0 flex flex-wrap items-end gap-2" do |f| %>
              <%= f.hidden_field :opponent_id, name: "match[opponent_id]", value: m.user_id %>
              <div class="min-w-[160px]">
                <label class="block text-xs font-medium text-slate-500 mb-0.5">Proposed time</label>
                <%= f.datetime_local_field :scheduled_at, name: "match[scheduled_at]", class: "w-full rounded-lg border border-slate-300 px-2.5 py-2 text-sm focus:border-green-500 focus:ring-1 focus:ring-green-500/20 min-h-[40px]" %>
              </div>
              <div class="min-w-[120px]">
                <label class="block text-xs font-medium text-slate-500 mb-0.5">Location</label>
                <%= f.text_field :location, name: "match[location]", placeholder: "e.g. Wash Park", class: "w-full rounded-lg border border-slate-300 px-2.5 py-2 text-sm focus:border-green-500 focus:ring-1 focus:ring-green-500/20 min-h-[40px]" %>
              </div>
              <%= f.submit "Challenge", class: "rounded-xl bg-green-500 hover:bg-green-600 text-white font-medium px-4 py-2.5 text-sm min-h-[44px] transition-colors" %>
            <% end %>
          <% end %>
        </li>
      <% end %>
    </ul>
  <% else %>
    <p class="px-4 sm:px-5 py-6 text-slate-500 text-sm">No members yet.</p>
  <% end %>
</section>

<p class="mt-6">
  <%= link_to "Back to pools", leagues_path, class: "text-green-600 hover:text-green-700 font-medium" %>
</p>
